name: Compare Blocklists

on:
  workflow_run:
    workflows: ["Merge Blocklists"]
    types:
      - completed
  workflow_dispatch:

permissions:
  contents: write

jobs:
  compare:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: So sรกnh vร tแบกo danh sรกch khรกc biแปt
        run: |
          mkdir -p logs

          if [[ -f merged_blocklist.txt && -f my-blocklist.txt ]]; then
            sort merged_blocklist.txt > sorted_merged.txt
            sort my-blocklist.txt > sorted_my.txt

            comm -23 sorted_merged.txt sorted_my.txt > diff_from_merged.txt

            echo "โ ฤรฃ tรฌm thแบฅy $(wc -l < diff_from_merged.txt) domain chแป cรณ trong merged_blocklist.txt"
          else
            echo "โ Mแปt trong hai file chฦฐa tแปn tแบกi. Kiแปm tra lแบกi merge/export."
            exit 1
          fi

      - name: Commit & Push kแบฟt quแบฃ
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add diff_from_merged.txt
          git commit -m "๐ Tแปฑ ฤแปng tแบกo diff_from_merged.txt sau khi merge"
          git push || echo "โ๏ธ Khรดng cรณ thay ฤแปi ฤแป commit"
